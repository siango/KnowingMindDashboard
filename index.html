<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KnowingMind Dashboard</title>
<style>
  :root{--bg:#0f1623;--panel:#121a29;--ink:#e6eefc;--minor:#9bb3d1;--ok:#10b981;--bad:#ef4444;--card:#0b1320;--brand:#4aa3ff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{display:flex;min-height:100vh}
  aside{width:240px;background:var(--panel);padding:18px}
  .brand{font-weight:700;color:#fff;margin-bottom:12px}
  .tab{display:block;width:100%;text-align:left;background:#0d1a30;border:1px solid #1e2b45;color:#cfe2ff;
       padding:10px 12px;margin:6px 0;border-radius:8px;cursor:pointer}
  .tab:hover,.tab.active{background:#0d1a3a;color:#fff}
  main{flex:1;padding:22px;overflow:auto}
  h1{margin:6px 0 10px}
  .bar{font-size:14px;color:var(--minor);margin-bottom:16px}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin:12px 0 18px}
  .card{background:var(--card);border:1px solid #1e2b45;border-radius:12px;padding:14px}
  .k{color:var(--minor)}
  .chip{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid #27476b;margin-left:6px}
  .ok{color:#caffd7;border-color:#13543c;background:#042d20}
  .bad{color:#ffd1d1;border-color:#542323;background:#2a0c0c}
  .time{font-size:12px;color:var(--minor)}
  pre{background:#0b1320;color:#b9d1ff;border:1px dashed #27476b;border-radius:10px;padding:14px;overflow:auto}
  .hint{font-size:12px;color:var(--minor);margin-top:6px}
  .count{font-variant-numeric:tabular-nums}
</style>
</head>
<body>
<div class="wrap">
  <aside>
    <div class="brand">üìò KM Suite</div>
    <button class="tab active" data-page="home">üè† Home</button>
    <button class="tab" data-page="dashboard">üìä Dashboard</button>
    <button class="tab" data-page="update">‚¨ÜÔ∏è Update</button>
    <button class="tab" data-page="gas">üõ†Ô∏è GAS</button>
  </aside>

  <main>
    <section id="page-home">
      <h1>KnowingMind Dashboard</h1>
      <div class="bar" id="status-bar">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>

      <div class="cards" id="cards">
        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
      </div>

      <div class="time">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å <span class="count" id="every">60</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å <span class="count" id="left">60</span> ‡∏ß‡∏¥</div>

      <p class="hint">‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏• JSON ‡∏î‡∏¥‡∏ö (‡πÑ‡∏ß‡πâ‡∏î‡∏µ‡∏ö‡∏±‡∏Å):</p>
      <pre id="dash-json">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>
    </section>

    <section id="page-dashboard" hidden>
      <h1>Dashboard</h1>
      <pre id="dash-raw-more">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>
    </section>

    <section id="page-update" hidden>
      <h1>Update</h1>
      <p>‡∏û‡∏¥‡∏°‡∏û‡πå <code>km-update</code> ‡πÉ‡∏ô Termux ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏ß‡∏¥‡∏î‡πÄ‡∏à‡πá‡∏ï ‚Äú‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó_Dashboard‚Äù</p>
    </section>

    <section id="page-gas" hidden>
      <h1>GAS Test</h1>
      <pre id="gas-out">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>
    </section>
  </main>
</div>

<script>
/* == Tab switcher == */
const tabs=[...document.querySelectorAll('.tab')];
const pages={
  home:document.getElementById('page-home'),
  dashboard:document.getElementById('page-dashboard'),
  update:document.getElementById('page-update'),
  gas:document.getElementById('page-gas'),
};
tabs.forEach(btn=>{
  btn.onclick=()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    Object.values(pages).forEach(p=>p.hidden=true);
    pages[btn.dataset.page].hidden=false;
  };
});

/* == Auto-refresh countdown == */
const EVERY = 60; // ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
document.getElementById('every').textContent = EVERY;
let left = EVERY;
setInterval(()=> {
  left--; if (left<=0) location.reload();
  document.getElementById('left').textContent = left;
}, 1000);

/* == Render status cards ‡∏à‡∏≤‡∏Å JSON ‡πÉ‡∏ô <pre id="dash-json"> ==
   *** ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ***
   ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° JSON ‡∏•‡∏á‡πÉ‡∏ô <pre> ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà) */
function renderCards() {
  const pre = document.getElementById('dash-json');
  const cards = document.getElementById('cards');
  const bar = document.getElementById('status-bar');
  let data = null;
  try { data = JSON.parse(pre.textContent.trim()); }
  catch { /* ‡∏¢‡∏±‡∏á parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡πá‡∏£‡∏≠‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô */ return; }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
  const health = data.health || {};
  const dash   = data.dashboard || {};
  const okHealth = !!health.ok;
  const okDash   = !!dash.ok;

  const when = new Date().toLocaleString('th-TH',{hour12:false});
  bar.textContent = `health: ${okHealth?'alive':'dead'} | dashboard: ${okDash?'ok':'error'} @ ${when}`;

  cards.innerHTML = `
    <div class="card">
      <div><b>Health</b><span class="chip ${okHealth?'ok':'bad'}">${okHealth?'OK':'ERR'}</span></div>
      <div class="k">file</div><div>${health.file||'-'}</div>
      <div class="k">sheets</div><div>${(health.sheets||[]).join(', ')||'-'}</div>
    </div>
    <div class="card">
      <div><b>Dashboard</b><span class="chip ${okDash?'ok':'bad'}">${okDash?'OK':'ERR'}</span></div>
      <div class="k">file</div><div>${dash.file||'-'}</div>
      <div class="k">sheets</div><div>${(dash.sheets||[]).join(', ')||'-'}</div>
    </div>
  `;

  // ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤ JSON ‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡πÅ‡∏ó‡πá‡∏ö (Dashboard)
  const rawMore = document.getElementById('dash-raw-more');
  rawMore.textContent = JSON.stringify(data,null,2);
}

/* ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° render ‡∏ó‡∏∏‡∏Å‡πÜ 500ms ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ parse JSON ‡πÑ‡∏î‡πâ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á) */
let tries=0;
const t = setInterval(()=>{
  tries++;
  try { renderCards(); if (document.getElementById('cards').children.length) clearInterval(t); }
  catch {}
  if (tries>40) clearInterval(t); // 20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏û‡∏≠
}, 500);
</script>
</body>
</html>
