<!doctype html><html lang="th"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KnowingMind Dashboard</title>
<style>
  :root{--bg:#0b1020;--card:#10172a;--text:#e5e7eb;--muted:#9ca3af;--line:#2a3655;--pos:#22c55e;--zero:#9ca3af;}
  @media (prefers-color-scheme: light){
    :root{--bg:#f6f7fb;--card:#ffffff;--text:#1f2937;--muted:#6b7280;--line:#e5e7eb;--pos:#15803d;--zero:#9ca3af;}
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Prompt,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:20px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.15)}
  h1{margin:0 0 4px 0;font-size:24px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:14px}
  .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px;margin:8px 0 14px}
  .kpi{border:1px solid var(--line);border-radius:12px;padding:12px}
  .kpi .t{font-size:12px;color:var(--muted)}
  .kpi .v{font-weight:700;font-size:20px}
  table{width:100%;border-collapse:collapse;margin-top:10px;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  th,td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:center}
  th{background:rgba(255,255,255,.04)}
  tbody tr:last-child td{border-bottom:none}
  .pos{color:var(--pos);font-weight:700}
  .zero{color:var(--zero)}
  h2{margin:18px 0 8px 0;font-size:18px}
  ul{margin:8px 0 0 18px}
</style>
<body><div class="wrap">
  <div class="card">
    <h1>üìä KnowingMind Dashboard</h1>
    <div class="sub">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate">-</span></div>

    <div class="kpis">
      <div class="kpi"><div class="t">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (M‡∏ø)</div><div class="v" id="k_sum">-</div></div>
      <div class="kpi"><div class="t">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (M‡∏ø)</div><div class="v" id="k_delta">-</div></div>
      <div class="kpi"><div class="t">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô</div><div class="v" id="k_up">-</div></div>
    </div>

    <h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‚Äì‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
    <table id="tblMain"><thead>
      <tr><th>Project</th><th>Progress ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</th><th>Valuation (M‡∏ø)</th><th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° (M‡∏ø)</th></tr>
    </thead><tbody></tbody></table>

    <h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° + ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h2>
    <table id="tblDelta"><thead>
      <tr><th>Project</th><th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° (M‡∏ø)</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr>
    </thead><tbody></tbody></table>

    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
    <ul id="summary"></ul>

    <h2>Checklist ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
    <ul id="cks"></ul>
  </div>
</div>

<script>
async function get(url){const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error(url); return r.text();}
function csvRows(txt){return txt.trim().split(/\r?\n/).slice(1).map(r=>r.split(','));}

(async()=>{
  document.getElementById('lastUpdate').textContent =
    new Date().toLocaleString('th-TH',{hour12:false});

  // --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å ---
  const rows = csvRows(await get('projects_today.csv'));
  let sum=0, delta=0, ups=[];
  const tb = document.querySelector('#tblMain tbody');
  rows.forEach(([p,y,t,v,d])=>{
    sum += Number(v||0);
    delta += Number(d||0);
    if(Number(d)>0) ups.push(p);
    tb.insertAdjacentHTML('beforeend',
      `<tr><td style="text-align:left">${p}</td>
           <td>${y}%</td><td><b>${t}%</b></td><td>${v}</td>
           <td class="${(+d>0)?'pos':'zero'}">${d}</td></tr>`);
  });

  // --- ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô ---
  document.getElementById('k_sum').textContent   = sum.toLocaleString('th-TH');
  document.getElementById('k_delta').textContent = `+${delta.toLocaleString('th-TH')}`;
  document.getElementById('k_up').textContent    = ups.length;

  // --- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ---
  try{
    const reasons = JSON.parse(await get('delta_reason.json'));
    const tb2 = document.querySelector('#tblDelta tbody');
    reasons.forEach(o=>{
      tb2.insertAdjacentHTML('beforeend',
        `<tr><td style="text-align:left">${o.project}</td>
             <td class="${(o.delta>0)?'pos':'zero'}">${o.delta}</td>
             <td style="text-align:left">${o.reason}</td></tr>`);
    });
  }catch(e){}

  // --- ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ---
  const s = document.getElementById('summary');
  s.insertAdjacentHTML('beforeend',
    `<li>üìà Valuation ‡∏£‡∏ß‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: +${delta} M‡∏ø (‡∏£‡∏ß‡∏° ‚âà ${sum} M‡∏ø)</li>`);
  s.insertAdjacentHTML('beforeend',
    `<li>üîº ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏¢‡∏±‡∏ö‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô: ${ups.join(', ') || '‚Äî'}</li>`);

  // --- Checklist ---
  try{
    const ck = JSON.parse(await get('checklist.json'));
    const ul = document.getElementById('cks');
    ck.forEach(t=>ul.insertAdjacentHTML('beforeend', `<li>${t}</li>`));
  }catch(e){}
})();
</script>
</body></html>
